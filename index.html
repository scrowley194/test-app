<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Coach Lite — Daily Training</title>

<!-- iOS PWA bits -->
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<link rel="apple-touch-icon" href="icons/icon-192.png" />
<link rel="apple-touch-icon" sizes="512x512" href="icons/icon-512.png" />
<link rel="manifest" href="manifest.webmanifest" />
<meta name="theme-color" content="#0b0e14" />

<style>
  :root{
    --bg:#0b0e14; --card:#121826; --text:#e6ebf5; --muted:#96a3b6; --border:rgba(255,255,255,.08);
    --good:#6ee7b7; --warn:#fde68a; --bad:#fca5a5; --blue:#93c5fd; --r:14px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0; background:radial-gradient(1200px 800px at 100% -15%, #182235 0%, #0b0e14 55%), var(--bg); color:var(--text); font:16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial}
  .wrap{max-width:900px; margin:0 auto; padding:22px 16px 40px}
  header{display:flex; justify-content:space-between; align-items:flex-end; gap:12px; flex-wrap:wrap; margin-bottom:14px}
  h1{margin:0; font-size:24px}
  .muted{color:var(--muted)}
  .card{background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.01)); border:1px solid var(--border); border-radius:var(--r); padding:14px 14px 16px; box-shadow:0 10px 30px rgba(0,0,0,.25); backdrop-filter:blur(6px); margin-bottom:12px}
  .grid{display:grid; gap:10px}
  @media(min-width:760px){.grid-2{grid-template-columns:1fr 1fr}}
  .row{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
  .col{display:flex; flex-direction:column; gap:10px}
  button{background:#1b2333; border:1px solid var(--border); color:var(--text); padding:10px 12px; border-radius:10px; cursor:pointer; transition:.15s}
  button:hover{transform:translateY(-1px); box-shadow:0 6px 16px rgba(0,0,0,.25)}
  button.primary{background:linear-gradient(180deg, rgba(110,231,183,.18), rgba(110,231,183,.10)); border-color:rgba(110,231,183,.35)}
  button.warn{background:linear-gradient(180deg, rgba(253,230,138,.20), rgba(253,230,138,.12)); border-color:rgba(253,230,138,.35)}
  button.danger{background:linear-gradient(180deg, rgba(252,165,165,.18), rgba(252,165,165,.10)); border-color:rgba(252,165,165,.35)}
  input[type="number"], input[type="text"], select{background:#0e1422; color:var(--text); border:1px solid var(--border); border-radius:10px; padding:8px 10px}
  .exercise{border:1px solid var(--border); border-radius:12px; padding:10px}
  .tag{font-size:12px; color:var(--muted); border:1px solid var(--border); border-radius:999px; padding:2px 8px}
  .setrow{display:flex; gap:8px; align-items:center; margin-top:8px}
  .setrow input{width:86px}
  .small{font-size:12px}
  .pill{display:inline-flex; gap:8px; align-items:center; padding:6px 10px; border:1px solid var(--border); border-radius:999px}
  .timer{font-size:32px; font-weight:700; letter-spacing:1px}
  .ok{color:var(--good)} .warn-txt{color:var(--warn)} .bad{color:var(--bad)}
  canvas{width:100%; height:160px}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div>
      <h1>Coach Lite</h1>
      <div class="muted" id="today"></div>
    </div>
    <div class="row">
      <button id="export" class="primary">Export Markdown</button>
      <button id="resetDay" class="danger">Reset today</button>
    </div>
  </header>

  <!-- 1) Setup -->
  <section class="card" id="setup">
    <h3 style="margin:0 0 8px 0">Setup</h3>
    <div class="grid grid-2">
      <div class="col">
        <label>Goal
          <select id="goal">
            <option value="strength">Strength</option>
            <option value="hypertrophy" selected>Hypertrophy</option>
            <option value="fatloss">Conditioning</option>
          </select>
        </label>
        <label>Time available (minutes)
          <input id="minutes" type="number" min="15" step="5" value="45" />
        </label>
        <label>Split
          <select id="split">
            <option value="full">Full body</option>
            <option value="push" selected>Push</option>
            <option value="pull">Pull</option>
            <option value="legs">Legs</option>
            <option value="upper">Upper</option>
            <option value="lower">Lower</option>
          </select>
        </label>
      </div>
      <div class="col">
        <label>Equipment
          <select id="equipment">
            <option value="full" selected>Full gym</option>
            <option value="dumbbells">Dumbbells and bench</option>
            <option value="home">Bodyweight and bands</option>
          </select>
        </label>
        <label>Experience
          <select id="level">
            <option value="new">New</option>
            <option value="intermediate" selected>Intermediate</option>
            <option value="advanced">Advanced</option>
          </select>
        </label>
        <label>Warm up minutes
          <input id="warm" type="number" min="0" step="1" value="5" />
        </label>
      </div>
    </div>
    <div class="row" style="margin-top:10px">
      <button id="build" class="primary">Build today’s session</button>
      <button id="quickStart">Quick start</button>
      <span class="muted small">Compounds first, then accessories, core, optional finisher</span>
    </div>
  </section>

  <!-- 2) Session overview -->
  <section class="card" id="session" style="display:none">
    <div class="row" style="justify-content:space-between">
      <h3 style="margin:0">Today’s session</h3>
      <div class="row">
        <span class="pill"><span id="blockTime">0</span> minutes</span>
        <button id="startAll" class="warn">Start workout</button>
      </div>
    </div>
    <div id="exList" class="col" style="margin-top:10px"></div>
  </section>

  <!-- 3) Runner -->
  <section class="card" id="runner" style="display:none">
    <div class="row" style="justify-content:space-between">
      <h3 style="margin:0" id="runTitle">Runner</h3>
      <div class="timer" id="clock">01:00</div>
    </div>
    <div class="row" style="margin-top:8px">
      <button id="startT" class="primary">Start rest</button>
      <button id="pauseT">Pause</button>
      <button id="resetT">Reset</button>
      <span class="pill">Rest <input id="restLen" type="number" min="15" value="60" style="width:80px" /></span>
    </div>
    <div id="runArea" style="margin-top:10px"></div>
  </section>

  <!-- 4) History and PRs -->
  <section class="card" id="history">
    <h3 style="margin:0 0 8px 0">Progress</h3>
    <canvas id="chart" width="720" height="160" aria-label="Weekly volume chart"></canvas>
    <div id="lastPR" class="muted small" style="margin-top:6px"></div>
  </section>
</div>

<script>
(function(){
  const $ = s => document.querySelector(s);
  const $$ = s => Array.from(document.querySelectorAll(s));
  $("#today").textContent = new Date().toLocaleDateString(undefined, {weekday:"long", year:"numeric", month:"long", day:"numeric"});

  const STORE = "coachlite_v2";
  const S = load() || init();
  save();

  function init(){ return {
    prefs:{goal:"hypertrophy", minutes:45, split:"push", equipment:"full", level:"intermediate", warm:5},
    today:{date:dayISO(new Date()), plan:[], done:[]},
    lifts:{} // name -> { last:{weight,reps,sets}, history:[{d,vol,pr}] }
  };}

  function load(){ try{ return JSON.parse(localStorage.getItem(STORE)); }catch(e){ return null; } }
  function save(){ localStorage.setItem(STORE, JSON.stringify(S)); }
  function dayISO(d){ const x = new Date(d.getTime() - d.getTimezoneOffset()*60000); return x.toISOString().slice(0,10); }
  function pick(list, n){ const out=[], pool=[...list]; while(out.length<n && pool.length){ out.push(pool.splice(Math.floor(Math.random()*pool.length),1)[0]); } return out; }
  function AMRAP(){ return "AMRAP"; }

  // Library: name, type, equip, tags, defaults by goal [sets,reps]
  const L = [
    ["Back squat","compound","barbell",["legs","squat","lower"],{strength:[5,5],hypertrophy:[4,8],fatloss:[3,12]}],
    ["Front squat","compound","barbell",["legs","squat","lower"],{strength:[5,5],hypertrophy:[4,8],fatloss:[3,12]}],
    ["Deadlift","compound","barbell",["pull","hinge","lower"],{strength:[5,3],hypertrophy:[4,6],fatloss:[3,10]}],
    ["Romanian deadlift","compound","barbell",["pull","hinge","lower"],{strength:[5,5],hypertrophy:[4,8],fatloss:[3,12]}],
    ["Bench press","compound","barbell",["push","chest","upper"],{strength:[5,5],hypertrophy:[4,8],fatloss:[3,12]}],
    ["Incline DB press","accessory","dumbbell",["push","chest","upper"],{strength:[4,6],hypertrophy:[4,10],fatloss:[3,12]}],
    ["Overhead press","compound","barbell",["push","shoulders","upper"],{strength:[5,5],hypertrophy:[4,8],fatloss:[3,12]}],
    ["Pull up","compound","body",["pull","lats","upper"],{strength:[5,5],hypertrophy:[4,8],fatloss:[4,AMRAP()]}],
    ["Barbell row","accessory","barbell",["pull","back","upper"],{strength:[5,5],hypertrophy:[4,8],fatloss:[3,12]}],
    ["Seated cable row","accessory","machine",["pull","back","upper"],{strength:[4,6],hypertrophy:[4,10],fatloss:[3,12]}],
    ["Lateral raise","accessory","dumbbell",["shoulders","upper"],{strength:[3,12],hypertrophy:[3,15],fatloss:[3,20]}],
    ["Triceps pushdown","accessory","machine",["triceps","upper"],{strength:[3,10],hypertrophy:[3,12],fatloss:[3,15]}],
    ["Biceps curl","accessory","dumbbell",["biceps","upper"],{strength:[3,10],hypertrophy:[3,12],fatloss:[3,15]}],
    ["Hip thrust","accessory","barbell",["glutes","lower"],{strength:[5,5],hypertrophy:[4,8],fatloss:[3,12]}],
    ["Leg press","accessory","machine",["legs","lower"],{strength:[4,6],hypertrophy:[4,10],fatloss:[3,15]}],
    ["Goblet squat","accessory","dumbbell",["legs","lower"],{strength:[4,8],hypertrophy:[4,12],fatloss:[3,15]}],
    ["Hanging leg raise","core","body",["core"],{strength:[4,8],hypertrophy:[4,12],fatloss:[3,15]}],
    ["Cable crunch","core","machine",["core"],{strength:[4,12],hypertrophy:[4,15],fatloss:[3,20]}],
    ["Plank","core","body",["core","timed"],{strength:[3,45],hypertrophy:[3,60],fatloss:[3,60]}],
    ["Burpee finisher","finisher","body",["metcon"],{strength:[1,20],hypertrophy:[1,30],fatloss:[1,40]}],
    ["Bike sprint finisher","finisher","machine",["metcon"],{strength:[6,20],hypertrophy:[8,20],fatloss:[10,20]}]
  ];

  // Prefill UI from prefs
  $("#goal").value = S.prefs.goal;
  $("#minutes").value = S.prefs.minutes;
  $("#split").value = S.prefs.split;
  $("#equipment").value = S.prefs.equipment;
  $("#level").value = S.prefs.level;
  $("#warm").value = S.prefs.warm;

  $("#quickStart").addEventListener("click", ()=>{
    S.today = {date:dayISO(new Date()), plan:buildPlan(S.prefs), done:[]};
    save(); renderSession();
  });

  $("#build").addEventListener("click", ()=>{
    S.prefs = {
      goal:$("#goal").value,
      minutes:parseInt($("#minutes").value,10),
      split:$("#split").value,
      equipment:$("#equipment").value,
      level:$("#level").value,
      warm:parseInt($("#warm").value,10)
    };
    S.today = {date:dayISO(new Date()), plan:buildPlan(S.prefs), done:[]};
    save(); renderSession();
  });

  $("#resetDay").addEventListener("click", ()=>{
    if(!confirm("Reset today’s workout")) return;
    S.today = {date:dayISO(new Date()), plan:[], done:[]}; save();
    $("#session").style.display = "none"; $("#runner").style.display = "none";
  });

  function allowEquip(item, equip){
    const e = item[2];
    if(equip === "full") return true;
    if(equip === "dumbbells") return e === "dumbbell" || e === "body";
    if(equip === "home") return e === "body" || e === "bands" || item[0]==="Goblet squat";
    return true;
  }

  function matchSplit(item, split){
    if(split === "full") return true;
    const tags = item[3];
    if(split === "push") return tags.includes("push") || tags.includes("chest") || tags.includes("shoulders") || tags.includes("triceps");
    if(split === "pull") return tags.includes("pull") || tags.includes("back") || tags.includes("lats") || tags.includes("biceps");
    if(split === "legs" || split === "lower") return tags.includes("lower") || tags.includes("legs");
    if(split === "upper") return tags.includes("upper") || tags.includes("push") || tags.includes("pull");
    return true;
  }

  function makeBlock(item, goal, level, isFinisher=false){
    const [name, type, equip, tags, defaults] = item;
    const [sets, reps] = defaults[goal];
    const rest = type==="compound" ? 120 : type==="finisher" ? 30 : 75;
    const targetRPE = level==="new" ? 7 : level==="intermediate" ? 8 : 9;
    const startWeight = suggestWeight(name, reps);
    return { name, type, equip, tags, sets, reps, rest, targetRPE, weight:startWeight, isFinisher, setReps:{}, setRPE:{} };
  }

  function suggestWeight(lift, reps){
    const last = S.lifts[lift]?.last;
    if(last){
      const step = reps !== "AMRAP" && reps <= 6 ? 2.5 : 0;
      return Math.max(0, Math.round((last.weight + step) * 2) / 2);
    }
    return 0;
  }

  function estimateTime(b){
    if(b.isFinisher) return Math.max(6, Math.round(b.sets * (b.reps/20 + b.rest/60)));
    return Math.round(b.sets * (40/60) + (b.sets-1) * (b.rest/60)) + 2;
  }

  function buildPlan(prefs){
    const {goal, minutes, split, equipment, level, warm} = prefs;

    const comp = L.filter(x => x[1]==="compound" && allowEquip(x,equipment) && matchSplit(x,split));
    const acc = L.filter(x => x[1]==="accessory" && allowEquip(x,equipment) && matchSplit(x,split));
    const core = L.filter(x => x[1]==="core" && allowEquip(x,equipment));
    const fin = L.filter(x => x[1]==="finisher" && allowEquip(x,equipment));

    const plan = [];

    // Warm up info is implicit in time
    let timeBudget = Math.max(10, minutes - warm);

    const compPick = pick(comp, Math.min(2, comp.length));
    compPick.forEach(c => plan.push(makeBlock(c, goal, level)));

    const accPick = pick(acc, Math.min(2, acc.length));
    accPick.forEach(a => plan.push(makeBlock(a, goal, level)));

    const corePick = pick(core, 1);
    if(corePick[0]) plan.push(makeBlock(corePick[0], goal, level));

    if(goal !== "strength" && timeBudget >= 35 && fin.length){
      plan.push(makeBlock(pick(fin,1)[0], goal, level, true));
    }

    // Trim if over budget
    let mins = plan.reduce((m,b)=>m+estimateTime(b), 0);
    while(mins > timeBudget && plan.length > 3){ plan.pop(); mins = plan.reduce((m,b)=>m+estimateTime(b), 0); }

    return plan;
  }

  // Session render
  function renderSession(){
    const el = $("#exList"); el.innerHTML = "";
    const plan = S.today.plan;
    if(!plan.length){ $("#session").style.display = "none"; return; }
    let mins = 0;

    plan.forEach((b, idx)=>{
      mins += estimateTime(b);
      const wrap = document.createElement("div");
      wrap.className = "exercise";
      wrap.innerHTML = `
        <div class="row" style="justify-content:space-between">
          <div>
            <strong>${b.name}</strong>
            <span class="tag">${b.type}</span>
            <span class="tag">${b.reps==='AMRAP' ? 'AMRAP' : `${b.sets} × ${b.reps}`}</span>
            <span class="tag">Rest ${b.rest}s</span>
            <span class="tag">RPE ${b.targetRPE}</span>
          </div>
          <div class="row">
            <label class="small muted">Weight <input type="number" step="0.5" value="${b.weight||0}" data-w="${idx}" style="width:90px" /></label>
            <button class="swap" data-i="${idx}">Swap</button>
            <button class="run primary" data-i="${idx}">Run</button>
          </div>
        </div>
        <div class="col" style="margin-top:6px">
          ${[...Array(b.sets)].map((_,s)=>`
            <div class="setrow">
              <span class="small muted">Set ${s+1}</span>
              <label class="small muted">Reps <input type="number" min="1" value="${b.reps==='AMRAP'?0:b.reps}" data-r="${idx}:${s}" /></label>
              <label class="small muted">RPE <input type="number" min="5" max="10" step="0.5" value="${b.targetRPE}" data-e="${idx}:${s}" /></label>
              <button class="mark" data-m="${idx}:${s}">Done</button>
            </div>`).join("")}
        </div>
      `;
      el.appendChild(wrap);
    });

    $("#blockTime").textContent = mins;
    $("#session").style.display = "block";
    attachSessionHandlers();
  }

  function attachSessionHandlers(){
    $$(".swap").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        const i = parseInt(btn.dataset.i,10);
        const cur = S.today.plan[i];
        const pool = L.filter(x => x[1]===cur.type && allowEquip(x, S.prefs.equipment) && matchSplit(x, S.prefs.split) && x[0]!==cur.name);
        if(!pool.length) return;
        const pickOne = pool[Math.floor(Math.random()*pool.length)];
        S.today.plan[i] = makeBlock(pickOne, S.prefs.goal, S.prefs.level, cur.isFinisher);
        save(); renderSession();
      });
    });

    $$("input[data-w]").forEach(inp=>{
      inp.addEventListener("input", e=>{
        const idx = parseInt(inp.dataset.w,10);
        S.today.plan[idx].weight = parseFloat(e.target.value||0);
        save();
      });
    });

    $$("input[data-r]").forEach(inp=>{
      inp.addEventListener("input", e=>{
        const [i,s] = inp.dataset.r.split(":").map(Number);
        S.today.plan[i].setReps[s] = parseInt(e.target.value||0,10);
        save();
      });
    });

    $$("input[data-e]").forEach(inp=>{
      inp.addEventListener("input", e=>{
        const [i,s] = inp.dataset.e.split(":").map(Number);
        S.today.plan[i].setRPE[s] = parseFloat(e.target.value||0);
        save();
      });
    });

    $$(".run").forEach(btn=>{
      btn.addEventListener("click", ()=> openRunner(parseInt(btn.dataset.i,10)));
    });

    $("#startAll").onclick = ()=> openRunner(0);
  }

  // Runner
  let timer = null, left = 60;
  function setClock(sec){ left = sec; renderClock(); }
  function renderClock(){ const m = String(Math.floor(left/60)).padStart(2,"0"); const s = String(left%60).padStart(2,"0"); $("#clock").textContent = `${m}:${s}`; }
  function tick(){ left -= 1; if(left <= 0){ if(navigator.vibrate) navigator.vibrate(40); clearInterval(timer); timer = null; } renderClock(); }

  $("#startT").onclick = ()=>{ if(timer) return; timer = setInterval(tick, 1000); };
  $("#pauseT").onclick = ()=>{ if(timer){ clearInterval(timer); timer = null; } };
  $("#resetT").onclick = ()=>{ if(timer){ clearInterval(timer); timer = null; } setClock(parseInt($("#restLen").value,10)); };

  function openRunner(i){
    const b = S.today.plan[i];
    if(!b) return;
    $("#runTitle").textContent = `${b.name} — ${b.reps==='AMRAP'?'AMRAP':b.sets + ' × ' + b.reps}`;
    const area = $("#runArea"); area.innerHTML = "";

    for(let s=0; s<b.sets; s++){
      const reps = b.setReps[s] ?? (b.reps==='AMRAP'?0:b.reps);
      const rpe = b.setRPE[s] ?? b.targetRPE;
      const row = document.createElement("div");
      row.className = "setrow";
      row.innerHTML = `
        <span class="small muted">Set ${s+1}</span>
        <label class="small muted">Reps <input type="number" min="1" value="${reps}" data-r="${i}:${s}" style="width:86px" /></label>
        <label class="small muted">RPE <input type="number" min="5" max="10" step="0.5" value="${rpe}" data-e="${i}:${s}" style="width:86px" /></label>
        <button class="mark primary" data-m="${i}:${s}">Mark done</button>
      `;
      area.appendChild(row);
    }

    // handlers inside runner
    area.querySelectorAll(".mark").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        const [ii, ss] = btn.dataset.m.split(":").map(Number);
        S.today.done.push({i:ii, s:ss, t:Date.now()});
        const blk = S.today.plan[ii];
        const reps = blk.setReps[ss] ?? (blk.reps==='AMRAP'?0:blk.reps);
        const weight = blk.weight || 0;
        const vol = weight * reps;
        S.lifts[blk.name] = S.lifts[blk.name] || {last:{}, history:[]};
        S.lifts[blk.name].last = {weight, reps, sets:blk.sets};
        const d = dayISO(new Date());
        const prevTop = topVol(blk.name);
        S.lifts[blk.name].history.push({d, vol, pr: vol > prevTop});
        save();
        btn.disabled = true; btn.textContent = "Done";
        setClock(parseInt($("#restLen").value,10));
        if(navigator.vibrate) navigator.vibrate(30);
      });
    });

    $("#runner").style.display = "block";
    $("#runner").scrollIntoView({behavior:"smooth"});
    setClock(parseInt($("#restLen").value,10));
    drawChart(); showPR();
  }

  function topVol(lift){
    const h = S.lifts[lift]?.history || [];
    return h.reduce((m,x)=>Math.max(m, x.vol), 0);
  }

  // Chart: total daily volume over last 7 days
  function drawChart(){
    const c = $("#chart"); const ctx = c.getContext("2d");
    ctx.clearRect(0,0,c.width,c.height);
    const days = [...Array(7)].map((_,i)=>{ const d = new Date(); d.setDate(d.getDate()-6+i); return dayISO(d); });
    const totals = {};
    Object.values(S.lifts).forEach(L=>{
      L.history.forEach(h=>{ totals[h.d] = (totals[h.d]||0) + h.vol; });
    });
    const vals = days.map(d=> totals[d]||0);
    const w = c.width, h = c.height, pad = 28;
    const slot = (w - pad*2) / 7, barW = slot*0.6;
    const max = Math.max(10, ...vals);
    days.forEach((d,i)=>{
      const x = pad + i*slot + (slot-barW)/2;
      const y = h - pad;
      const bh = Math.round((vals[i]/max) * (h - pad*2));
      const has = vals[i] > 0;
      ctx.fillStyle = has ? "#6ee7b7" : "rgba(255,255,255,.08)";
      ctx.fillRect(x, y - bh, barW, bh);
      ctx.fillStyle = "#96a3b6"; ctx.font = "12px ui-monospace, monospace";
      const label = ["Mon","Tue","Wed","Thu","Fri","Sat","Sun"][i];
      ctx.fillText(label, x + barW/2 - 10, h - 8);
    });
  }
  drawChart();

  function showPR(){
    const prs = [];
    Object.entries(S.lifts).forEach(([name, v])=>{
      const last = v.history[v.history.length-1];
      if(last?.pr) prs.push(name);
    });
    $("#lastPR").textContent = prs.length ? "New PRs today: " + prs.join(", ") : "No new PRs today";
  }
  showPR();

  // Export
  $("#export").addEventListener("click", ()=>{
    const d = new Date().toISOString().slice(0,10);
    const lines = [];
    lines.push(`# Coach Lite — ${d}`);
    lines.push("");
    lines.push(`Goal: ${S.prefs.goal} • Split: ${S.prefs.split} • Equipment: ${S.prefs.equipment}`);
    lines.push("");
    S.today.plan.forEach(b=>{
      const w = b.weight || 0;
      lines.push(`- ${b.name}: ${b.reps==='AMRAP' ? `${b.sets} × AMRAP` : `${b.sets} × ${b.reps}`} @ ${w} kg, Rest ${b.rest}s, RPE ${b.targetRPE}`);
    });
    lines.push("");
    const totals = {};
    Object.values(S.lifts).forEach(L=> L.history.forEach(h=> totals[h.d]=(totals[h.d]||0)+h.vol));
    const todayVol = totals[dayISO(new Date())] || 0;
    lines.push(`Total volume today: ${todayVol.toFixed(0)}`);
    const blob = new Blob([lines.join("\n")], {type:"text/markdown"});
    const url = URL.createObjectURL(blob); const a = document.createElement("a");
    a.href = url; a.download = `coach-${d}.md`; a.click(); URL.revokeObjectURL(url);
  });

})();
</script>
</body>
</html>
